

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>SCP support &mdash; The Bastion 3.08.01 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/thebastion.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="HTTPS Proxy" href="http_proxy.html" />
    <link rel="prev" title="PIV keys support" href="piv.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> The Bastion
          

          
          </a>

          
            
            
              <div class="version">
                3.08.01
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Presentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../presentation/principles.html">Principles</a></li>
<li class="toctree-l1"><a class="reference internal" href="../presentation/features.html">Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="../presentation/security.html">Security</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq.html">FAQ</a></li>
</ul>
<p class="caption"><span class="caption-text">Installation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../installation/basic.html">Basic Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation/advanced.html">Advanced Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation/upgrading.html">Upgrading</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation/docker.html">Sandbox using Docker</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation/tests.html">Running Tests</a></li>
</ul>
<p class="caption"><span class="caption-text">Usage</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="basics/index.html">The basics</a></li>
<li class="toctree-l1"><a class="reference internal" href="piv.html">PIV keys support</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">SCP support</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#introduction">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="#prerequisites">Prerequisites</a></li>
<li class="toctree-l2"><a class="reference internal" href="#basic-usage">Basic usage</a></li>
<li class="toctree-l2"><a class="reference internal" href="#access-model">Access model</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#error-message-1">Error message 1</a></li>
<li class="toctree-l3"><a class="reference internal" href="#error-message-2">Error message 2</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="http_proxy.html">HTTPS Proxy</a></li>
</ul>
<p class="caption"><span class="caption-text">Administration</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../administration/configuration/index.html">Configuration files</a></li>
<li class="toctree-l1"><a class="reference internal" href="../administration/logs.html">Logs</a></li>
</ul>
<p class="caption"><span class="caption-text">Plugins</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../plugins/admin/index.html">admin plugins</a></li>
<li class="toctree-l1"><a class="reference internal" href="../plugins/group-aclkeeper/index.html">group-aclkeeper plugins</a></li>
<li class="toctree-l1"><a class="reference internal" href="../plugins/group-gatekeeper/index.html">group-gatekeeper plugins</a></li>
<li class="toctree-l1"><a class="reference internal" href="../plugins/group-owner/index.html">group-owner plugins</a></li>
<li class="toctree-l1"><a class="reference internal" href="../plugins/open/index.html">open plugins</a></li>
<li class="toctree-l1"><a class="reference internal" href="../plugins/restricted/index.html">restricted plugins</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">The Bastion</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
      <li>SCP support</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/using/scp.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="scp-support">
<h1><a class="toc-backref" href="#id1">SCP support</a><a class="headerlink" href="#scp-support" title="Permalink to this headline">¶</a></h1>
<div class="contents topic" id="contents">
<p class="topic-title">Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#scp-support" id="id1">SCP support</a><ul>
<li><a class="reference internal" href="#introduction" id="id2">Introduction</a></li>
<li><a class="reference internal" href="#prerequisites" id="id3">Prerequisites</a></li>
<li><a class="reference internal" href="#basic-usage" id="id4">Basic usage</a></li>
<li><a class="reference internal" href="#access-model" id="id5">Access model</a><ul>
<li><a class="reference internal" href="#error-message-1" id="id6">Error message 1</a></li>
<li><a class="reference internal" href="#error-message-2" id="id7">Error message 2</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="introduction">
<h2><a class="toc-backref" href="#id2">Introduction</a><a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>The Bastion's main goal is to secure <code class="docutils literal notranslate"><span class="pre">ssh</span></code> connections. However, one might also want to use <code class="docutils literal notranslate"><span class="pre">scp</span></code> through it.</p>
<p>Its use is supported through the <a class="reference internal" href="../plugins/open/scp.html"><span class="doc">scp</span></a> bastion plugin, and documented as part of all the plugins.
This additional documentation section gives some examples and outlines some common configuration errors.</p>
</div>
<div class="section" id="prerequisites">
<h2><a class="toc-backref" href="#id3">Prerequisites</a><a class="headerlink" href="#prerequisites" title="Permalink to this headline">¶</a></h2>
<p>The use of SCP through the bastion requires an SCP program than supports the <strong>-S</strong> option,
and a shell to run the wrapper. This is the case on all operating systems using OpenSSH such as Linux or *BSD.</p>
<p>If you're running under Microsoft Windows, you might want to setup either a Linux VM, or a WSL (Windows Subsystem
for Linux) environment, to have the OpenSSH version of <strong>scp</strong> and a working POSIX-style shell.</p>
<p>Note that it won't work with Windows GUI apps, because there's no way to specify a wrapper (through <strong>-S</strong>),
and no shell. For example, it won't work under WinSCP.</p>
<p>Also note that only SCP is supported, <em>not SFTP</em>.</p>
</div>
<div class="section" id="basic-usage">
<h2><a class="toc-backref" href="#id4">Basic usage</a><a class="headerlink" href="#basic-usage" title="Permalink to this headline">¶</a></h2>
<p>Please check the <a class="reference internal" href="../plugins/open/scp.html"><span class="doc">scp</span></a> documentation to see how to use it.</p>
</div>
<div class="section" id="access-model">
<h2><a class="toc-backref" href="#id5">Access model</a><a class="headerlink" href="#access-model" title="Permalink to this headline">¶</a></h2>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Currently, to be able to use SCP with a remote server, you first need to have a declared SSH access to it. This might change in a future version.</p>
</div>
<div class="section" id="error-message-1">
<h3><a class="toc-backref" href="#id6">Error message 1</a><a class="headerlink" href="#error-message-1" title="Permalink to this headline">¶</a></h3>
<p>This is briefly explained in the <a class="reference internal" href="../plugins/open/scp.html"><span class="doc">scp</span></a> documentation, but having access rights to SSH to a machine
is not enough to have the right to SCP to or from it. If you have the following error, then this is your problem:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Sorry</span><span class="p">,</span> <span class="n">you</span> <span class="n">seem</span> <span class="n">to</span> <span class="n">have</span> <span class="n">access</span> <span class="n">through</span> <span class="n">ssh</span> <span class="ow">and</span> <span class="n">through</span> <span class="n">scp</span> <span class="n">but</span> <span class="n">by</span> <span class="n">different</span> <span class="ow">and</span> <span class="n">distinct</span> <span class="n">means</span> <span class="p">(</span><span class="n">distinct</span> <span class="n">keys</span><span class="p">)</span><span class="o">.</span>
<span class="n">The</span> <span class="n">intersection</span> <span class="n">between</span> <span class="n">your</span> <span class="n">rights</span> <span class="k">for</span> <span class="n">ssh</span> <span class="ow">and</span> <span class="k">for</span> <span class="n">scp</span> <span class="n">needs</span> <span class="n">to</span> <span class="n">be</span> <span class="n">at</span> <span class="n">least</span> <span class="n">one</span><span class="o">.</span>
</pre></div>
</div>
<p>When this happens, it means that you have at least one declared SSH access to this machine (through one or
several groups, or through personal accesses). You also have at least one declared SCP access to it.
However <strong>both accesses are declared through different means</strong>, and more precisely different SSH keys. For example:</p>
<ul class="simple">
<li>You are a member of a group having this machine on one hand, and you have a declared SCP access to this machine
using a personal access on the other hand. For SSH, the group key would be used, but for SCP, your personal key
would be used. However, for technical reasons (that might be lifted in a future version), your SSH and SCP access
must be declared with the same key, so in other words, using the same access mean (same group, or personal access).</li>
<li>You are a member of group <strong>A</strong> having this machine, but SCP access is declared in group <strong>B</strong>.
In that case, as previously, as two different keys are used, this won't work.</li>
</ul>
<p>To declare an SCP access, in addition to a preexisting SSH access, you should use either:</p>
<ul class="simple">
<li><a class="reference internal" href="../plugins/group-aclkeeper/groupAddServer.html"><span class="doc">groupAddServer</span></a>, if the SSH access is part of a group</li>
<li><a class="reference internal" href="../plugins/restricted/selfAddPersonalAccess.html"><span class="doc">selfAddPersonalAccess</span></a> or <a class="reference internal" href="../plugins/restricted/accountAddPersonalAccess.html"><span class="doc">accountAddPersonalAccess</span></a>,
if the SSH access is personal (tied to an account)</li>
</ul>
<p>In both cases, where you would use the <code class="docutils literal notranslate"><span class="pre">--user</span></code> option to the command, to specify the remote user to use for
the SSH access being declared, you should replace it by either <code class="docutils literal notranslate"><span class="pre">--scp-down</span></code> or <code class="docutils literal notranslate"><span class="pre">--scp-up</span></code>,
to specify that you're about to add an SCP access (not an SSH one), and which direction you want to allow.
You can allow both directions by using the command first with <code class="docutils literal notranslate"><span class="pre">--scp-down</span></code>, then with <code class="docutils literal notranslate"><span class="pre">--scp-up</span></code>.</p>
<p>For example, this is a valid command to add SCP access to a machine which is part of a group:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">bssh</span> <span class="o">--</span><span class="n">osh</span> <span class="n">groupAddServer</span> <span class="o">--</span><span class="n">group</span> <span class="n">mygroup</span> <span class="o">--</span><span class="n">host</span> <span class="n">scpserver</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">org</span> <span class="o">--</span><span class="n">port</span> <span class="mi">22</span> <span class="o">--</span><span class="n">scp</span><span class="o">-</span><span class="n">up</span>
</pre></div>
</div>
</div>
<div class="section" id="error-message-2">
<h3><a class="toc-backref" href="#id7">Error message 2</a><a class="headerlink" href="#error-message-2" title="Permalink to this headline">¶</a></h3>
<p>If you have the following message:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Sorry</span><span class="p">,</span> <span class="n">but</span> <span class="n">you</span> <span class="n">don</span><span class="s1">&#39;t seem to have access to HOST:IP</span>
</pre></div>
</div>
<p>Then it means that you don't even have SSH access to this machine. In that case, somebody should grant you access,
either by adding you to a group having this machine (<a class="reference internal" href="../plugins/group-gatekeeper/groupAddMember.html"><span class="doc">groupAddMember</span></a>) or by adding
this machine to your personal accesses (<a class="reference internal" href="../plugins/restricted/accountAddPersonalAccess.html"><span class="doc">accountAddPersonalAccess</span></a> or
<a class="reference internal" href="../plugins/restricted/selfAddPersonalAccess.html"><span class="doc">selfAddPersonalAccess</span></a>).</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="http_proxy.html" class="btn btn-neutral float-right" title="HTTPS Proxy" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="piv.html" class="btn btn-neutral float-left" title="PIV keys support" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2022, OVHcloud

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>